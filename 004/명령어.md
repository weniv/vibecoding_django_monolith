# Django 블로그 웹 애플리케이션 구축 가이드 (Templates 버전)

## URL 설계
```
'/' : 홈 페이지
'/about': 소개 페이지
'/contact': 연락처 페이지
'/blog': 블로그 메인 페이지
'/blog/1': 블로그 1번 글 페이지
'/blog/2': 블로그 2번 글 페이지
'/blog/태그명': 특정 태그의 블로그 글 페이지
'/admin': 관리자 페이지
```

## 초기 세팅 (Windows)
```bash
python -m venv venv
.\venv\Scripts\activate
pip install django
django-admin startproject config .
```

## 1. settings.py 설정
```python
# config/settings.py
ALLOWED_HOSTS = ["*"]
```

## 2. 데이터베이스 마이그레이션 및 서버 실행
```bash
python manage.py migrate
python manage.py runserver
```

## 3. main 앱 생성
```bash
python manage.py startapp main
```

## 4. settings.py에 앱 등록
```python
# config/settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'main',  # 추가
]
```

## 5. 모델 작성
```python
# main/models.py
from django.db import models
from django.utils.text import slugify

class Tag(models.Model):
    slug = models.SlugField(max_length=50, unique=True)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.slug

class Post(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    is_published = models.BooleanField(default=False)
    author = models.CharField(max_length=100, blank=True, null=True)
    tags = models.ManyToManyField(Tag, related_name='posts', blank=True)

    def __str__(self):
        return self.title

    class Meta:
        ordering = ['-created_at']  # 최신순 정렬
```

* ManyToManyField: Post와 Tag 모델 간의 다대다 관계를 설정합니다. 하나의 게시물은 여러 태그를 가질 수 있고, 하나의 태그는 여러 게시물에 연결될 수 있습니다. 둘 중에 한 쪽에 `related_name='posts'`를 지정하여, Tag 객체에서 해당 태그가 연결된 모든 게시물에 접근할 수 있도록 합니다.
* ForeignKey: 만약 게시물과 작성자(User) 간의 일대다 관계를 설정하려면 ForeignKey를 사용합니다. 이 경우, Post 모델에 `author = models.ForeignKey(User, on_delete=models.CASCADE)`와 같이 작성할 수 있습니다. CASCADE 옵션은 작성자가 삭제될 때 해당 작성자의 모든 게시물도 함께 삭제되도록 합니다. N쪽에 작성하는 코드입니다.
* OneToOneField: 만약 게시물과 상세 정보(PostDetail) 간의 일대일 관계를 설정하려면 OneToOneField를 사용합니다. 이 경우, PostDetail 모델에 `post = models.OneToOneField(Post, on_delete=models.CASCADE)`와 같이 작성할 수 있습니다. CASCADE 옵션은 게시물이 삭제될 때 해당 게시물의 상세 정보도 함께 삭제되도록 합니다. 1:1 관계에서 어느 쪽에나 작성할 수 있습니다.

## 6. 모델 마이그레이션
```bash
python manage.py makemigrations
python manage.py migrate
```

## 7. admin 등록
```python
# main/admin.py
from django.contrib import admin
from .models import Post, Tag

admin.site.register(Post)
admin.site.register(Tag)
```

## 8. 관리자 계정 생성
```bash
python manage.py createsuperuser
leehojun
leehojun@gmail.com
dlghwns1234!
```

## 9. 프로젝트 URL 설정
```python
# config/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path("admin/", admin.site.urls),
    path("", include("main.urls")),
    # 만약 앱이 여러개면 아래와 같이 추가됩니다.
    # path("blog/", include("blog.urls") # blog 앱에 urls.py가 있어야 합니다.
    # path("shop/", include("shop.urls") # shop 앱에 urls.py가 있어야 합니다.
]
```

## 10. main 앱 URL 설정
```python
# main/urls.py (새로 생성)
from django.urls import path
from . import views

urlpatterns = [
    path("", views.home, name="home"),
    path("about/", views.about, name="about"),
    path("contact/", views.contact, name="contact"),
    path("blog/", views.blog_index, name="blog_index"),
    path("blog/<int:post_id>/", views.blog_post, name="blog_post"),
    path("blog/<str:tag_name>/", views.blog_tag, name="blog_tag"),
]
```

## 11. templates 폴더 구조 생성
```bash
# main 앱 안에 templates 폴더 생성
mkdir main\templates
mkdir main\templates\main
```

폴더 구조:
```
main/
├── templates/
│   └── main/
│       ├── home.html
│       ├── about.html
│       ├── contact.html
│       ├── blog_index.html
│       ├── blog_post.html
│       └── blog_tag.html
```

## 12. HTML 템플릿 파일 작성

### home.html
```html
<!-- main/templates/main/home.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin-right: 10px;
        }
        nav a:hover {
            background-color: #555;
        }
        h1 {
            color: #333;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">홈</a>
        <a href="/about">소개</a>
        <a href="/contact">연락처</a>
        <a href="/blog">블로그</a>
    </nav>
    <h1>홈 페이지</h1>
    <p>Django 블로그에 오신 것을 환영합니다!</p>
</body>
</html>
```

### about.html
```html
<!-- main/templates/main/about.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소개 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin-right: 10px;
        }
        nav a:hover {
            background-color: #555;
        }
        h1 {
            color: #333;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">홈</a>
        <a href="/about">소개</a>
        <a href="/contact">연락처</a>
        <a href="/blog">블로그</a>
    </nav>
    <h1>소개 페이지</h1>
    <p>이것은 Django로 만든 블로그입니다.</p>
</body>
</html>
```

### contact.html
```html
<!-- main/templates/main/contact.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연락처 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin-right: 10px;
        }
        nav a:hover {
            background-color: #555;
        }
        h1 {
            color: #333;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">홈</a>
        <a href="/about">소개</a>
        <a href="/contact">연락처</a>
        <a href="/blog">블로그</a>
    </nav>
    <h1>연락처 페이지</h1>
    <p>Email: contact@example.com</p>
</body>
</html>
```

### blog_index.html
```html
<!-- main/templates/main/blog_index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>블로그 메인</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin-right: 10px;
        }
        nav a:hover {
            background-color: #555;
        }
        h1 {
            color: #333;
        }
        .post-list {
            list-style: none;
            padding: 0;
        }
        .post-list li {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .post-list a {
            color: #0066cc;
            text-decoration: none;
            font-size: 18px;
            font-weight: bold;
        }
        .post-list a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">홈</a>
        <a href="/about">소개</a>
        <a href="/contact">연락처</a>
        <a href="/blog">블로그</a>
    </nav>
    <h1>블로그 메인 페이지</h1>
    <ul class="post-list">
        {% for post in posts %}
        <li>
            <a href="/blog/{{ post.id }}/">{{ post.title }}</a>
            <p style="margin: 10px 0 0 0; color: #666;">작성일: {{ post.created_at|date:"Y년 m월 d일" }}</p>
        </li>
        {% empty %}
        <li>게시글이 없습니다.</li>
        {% endfor %}
    </ul>
</body>
</html>
```

### blog_post.html
```html
<!-- main/templates/main/blog_post.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin-right: 10px;
        }
        nav a:hover {
            background-color: #555;
        }
        h1 {
            color: #333;
        }
        .post-content {
            line-height: 1.6;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .post-meta {
            color: #666;
            margin-top: 10px;
            font-size: 14px;
        }
        .tags {
            margin-top: 20px;
        }
        .tags a {
            display: inline-block;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 3px;
            margin-right: 5px;
        }
        .tags a:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">홈</a>
        <a href="/about">소개</a>
        <a href="/contact">연락처</a>
        <a href="/blog">블로그</a>
    </nav>
    <h1>{{ post.title }}</h1>
    <div class="post-meta">
        작성일: {{ post.created_at|date:"Y년 m월 d일 H:i" }}
        {% if post.author %}
        | 작성자: {{ post.author }}
        {% endif %}
    </div>
    <div class="post-content">
        {{ post.content|linebreaks }}
    </div>
    <div class="tags">
        <strong>태그:</strong>
        {% for tag in post.tags.all %}
        <a href="/blog/{{ tag.slug }}/">{{ tag.name }}</a>
        {% empty %}
        <span>태그 없음</span>
        {% endfor %}
    </div>
    <p style="margin-top: 20px;">
        <a href="/blog/" style="color: #0066cc;">← 목록으로 돌아가기</a>
    </p>
</body>
</html>
```

### blog_tag.html
```html
<!-- main/templates/main/blog_tag.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ tag.name }} 태그</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            background-color: #333;
            padding: 10px;
            margin-bottom: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            margin-right: 10px;
        }
        nav a:hover {
            background-color: #555;
        }
        h1 {
            color: #333;
        }
        .post-list {
            list-style: none;
            padding: 0;
        }
        .post-list li {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        .post-list a {
            color: #0066cc;
            text-decoration: none;
            font-size: 18px;
            font-weight: bold;
        }
        .post-list a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <nav>
        <a href="/">홈</a>
        <a href="/about">소개</a>
        <a href="/contact">연락처</a>
        <a href="/blog">블로그</a>
    </nav>
    <h1>'{{ tag.name }}' 태그의 블로그 글</h1>
    <ul class="post-list">
        {% for post in posts %}
        <li>
            <a href="/blog/{{ post.id }}/">{{ post.title }}</a>
            <p style="margin: 10px 0 0 0; color: #666;">작성일: {{ post.created_at|date:"Y년 m월 d일" }}</p>
        </li>
        {% empty %}
        <li>이 태그에 해당하는 게시글이 없습니다.</li>
        {% endfor %}
    </ul>
    <p style="margin-top: 20px;">
        <a href="/blog/" style="color: #0066cc;">← 목록으로 돌아가기</a>
    </p>
</body>
</html>
```

## 13. 뷰 함수 작성 (render 사용)
```python
# main/views.py
from django.shortcuts import render, get_object_or_404
from .models import Post, Tag

def home(request):
    return render(request, 'main/home.html')

def about(request):
    return render(request, 'main/about.html')

def contact(request):
    return render(request, 'main/contact.html')

def blog_index(request):
    posts = Post.objects.filter(is_published=True)
    context = {
        'posts': posts
    }
    return render(request, 'main/blog_index.html', context)

def blog_post(request, post_id):
    post = get_object_or_404(Post, id=post_id, is_published=True)
    context = {
        'post': post
    }
    return render(request, 'main/blog_post.html', context)

def blog_tag(request, tag_name):
    tag = get_object_or_404(Tag, slug=tag_name)
    posts = tag.posts.filter(is_published=True)
    context = {
        'tag': tag,
        'posts': posts
    }
    return render(request, 'main/blog_tag.html', context)
```

* id와 pk는 모델에 선언되어 있지 않아도 Django가 자동으로 생성해주는 기본 키 필드입니다. 따라서 Post 모델에서 `id` 필드를 명시적으로 선언하지 않아도 `post.id`로 접근할 수 있습니다.

* **render() 함수**: 템플릿과 컨텍스트 데이터를 조합하여 HTML 응답을 생성합니다.
  - 첫 번째 인자: request 객체
  - 두 번째 인자: 템플릿 파일 경로 (앱이름/템플릿명.html)
  - 세 번째 인자 (선택): context 딕셔너리 (템플릿에 전달할 데이터)

* **context**: 템플릿에 전달할 데이터를 담은 딕셔너리입니다. 템플릿에서 `{{ 변수명 }}`으로 사용할 수 있습니다.

* **템플릿 태그**:
  - `{% for %} ... {% endfor %}`: 반복문
  - `{% if %} ... {% endif %}`: 조건문
  - `{{ 변수명 }}`: 변수 출력
  - `{{ 변수명|필터 }}`: 필터 적용 (예: `date:"Y년 m월 d일"`, `linebreaks`)

## 14. 서버 실행
```bash
python manage.py runserver
```

## 15. admin 페이지에서 게시물 및 태그 추가

```
# http://127.0.0.1:8000/admin 접속
# 관리자 계정으로 로그인
# Post, Tag 데이터 추가

# 게시물1
# Title: 첫 번째 블로그 글
# Content: 이것은 첫 번째 블로그 글의 내용입니다.
# is_published: 체크
# 태그: Django, Python

# 게시물2
# Title: 두 번째 블로그 글
# Content: 이것은 두 번째 블로그 글의 내용입니다.
# is_published: 체크
# 태그: 웹개발, Django

# 게시물3
# Title: 비공개 글
# Content: 이 글은 비공개입니다.
# is_published: 체크 해제
# 태그: 비공개
```

## 접속 URL
- http://127.0.0.1:8000/ : 홈 페이지
- http://127.0.0.1:8000/about : 소개 페이지
- http://127.0.0.1:8000/contact : 연락처 페이지
- http://127.0.0.1:8000/blog : 블로그 메인 페이지
- http://127.0.0.1:8000/blog/1 : 블로그 1번 글 페이지
- http://127.0.0.1:8000/admin : 관리자 페이지

## HttpResponse vs render() 차이점

### HttpResponse (이전 방식)
```python
def home(request):
    return HttpResponse("홈 페이지")  # 단순 문자열 반환
```

### render() (템플릿 사용)
```python
def home(request):
    return render(request, 'main/home.html')  # HTML 템플릿 파일 반환
```

**장점:**
- HTML 구조를 별도 파일로 관리하여 코드 가독성 향상
- 디자이너와 개발자의 협업이 용이
- 템플릿 상속, 필터, 태그 등 Django의 강력한 템플릿 기능 활용 가능
- 유지보수가 쉬움

## 테스트 데이터 추가
1. http://127.0.0.1:8000/admin 접속
2. 로그인 후 Post, Tag 데이터 추가
3. Post 작성 시 `is_published` 체크
4. Post에 Tag 연결
